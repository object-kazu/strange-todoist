# TODO管理Rubyアプリケーション仕様書

## プロジェクト概要
macOS/Ruby環境で動作するTODO管理アプリケーション。
2つのモード（TODOモード、カレンダーモード）を持つインタラクティブなCLIアプリケーション。
階層構造のプロジェクト・タスク管理と繰り返しタスク機能を備えた高機能TODO管理システム。

## 実行環境
- **OS**: macOS
- **言語**: Ruby
- **実行ファイル名**: `todo.rb`
- **実行方法**: `./todo.rb` または `ruby todo.rb`

## データ保存仕様
- **保存形式**: CSV
- **保存場所**: ホームディレクトリ内のドットファイル
  - メインデータ: `~/.todo_data.csv`
  - カレンダーデータ: `~/.todo_calendar.csv`
  - 設定データ: `~/.todo_config.csv`

## アーキテクチャ
- **クラスベース設計**: Project, Task, CalendarEntry クラス
- **データ管理**: 起動時にCSVから読み込み、終了時に保存
- **メモリ管理**: 実行中は全データをメモリ上で管理

## 機能仕様

### TODOモード
階層構造でプロジェクト・タスクを管理する基本機能

#### データ構造
```
project
  ├── task
  │   ├── sub-task
  │   │   └── sub-sub-task
  │   │       └── ...（無制限階層）
```

#### 書式・表示
- **プロジェクト**: `[1] (id:1)   プロジェクト名`
- **タスク**: `  [1.1] (id:2)   タスク名`
- **サブタスク**: `    [1.1.1] (id:3)   サブタスク名` (インデントで階層表現)

#### 実装済み機能

##### プロジェクト・タスク管理
1. **プロジェクト操作**
   - `p` プロジェクト作成
   - `pl` プロジェクト一覧表示
   - `pd` プロジェクト削除（関連タスクも削除、確認あり）

2. **タスク操作**
   - `t` タスク作成（IDベースで親を選択、階層対応）
   - `tl` タスク一覧表示（階層構造表示）
   - `f` タスク完了（→カレンダーに自動記録）
   - `td` タスク削除（子タスクも削除、確認あり）

3. **共通操作**
   - `rm` リネーム（プロジェクト・タスク統一、関連データ自動更新）
   - `cp` プライオリティ変更（高/中/低、色分け表示）
   - `cr` 繰り返し設定変更（none/daily/weekly/monthly）

##### プライオリティ管理
- **3段階設定**: 高（赤）/中（黄）/低（緑）
- **適用範囲**: プロジェクト・タスク両方
- **視覚化**: ANSIカラーコードによる色分け表示

##### 繰り返しタスク機能
- **設定値**: none(デフォルト), daily, weekly, monthly
- **表示**: タスク名の後に `[daily]` 等で表示
- **拡張予定**: weekly→週区分設定、monthly→週・曜日設定

### カレンダーモード
完了したタスクの履歴表示機能

#### 表示書式
```
週数 | 週区分   | 日付         | 完了タスク             | プロジェクト           
-----+----------+--------------+------------------------+------------------------
1    | 土日月   | 1, 2         | task1                  | project1               
     |          |              | task2                  | project2               
-----+----------+--------------+------------------------+------------------------
2    | 火水     | 3, 4         | -                      | -                      
```

#### 週区分（固定）
- 土日月
- 火水  
- 木金

#### 機能
- **月選択**: 今月/先月/指定月
- **全日表示**: 完了タスクがない日も表示（"-"で表示）
- **複数タスク対応**: 同日複数完了時は行を分けて表示
- **日本語対応**: 文字幅を考慮した整列表示

## ユーザーインターフェース

### 操作方式
- **メイン**: インタラクティブメニュー形式
- **出力**: 標準出力（色付き）
- **入力**: コマンドライン引数 + インタラクティブ入力

### メニュー構造

#### メインメニュー
```
=== TODO管理システム ===
t. TODOモード
c. カレンダーモード
q. 終了
モードを選択してください [t,c,q]: 
```

#### TODOモード（2段組レイアウト）
```
=== TODOモード ===
p.  プロジェクト作成        t.  タスク作成
pl. プロジェクト一覧表示     tl. タスク一覧表示
                        f.  タスク完了
pd. プロジェクト削除        td. タスク削除
----------------------------------------------------
rm. リネーム
cp. プライオリティ変更
cr. 繰り返し変更
r.  戻る
q.  終了
----------------------------------------------------
選択してください [p,t,pl,tl,f,pd,td,rm,cp,cr,r,q]: 
```

#### カレンダーモード
```
=== カレンダー (完了履歴) ===
表示する月を選択してください (1:今月, 2:先月, 3:指定月, r:戻る, q:終了) [1]: 
```

### 使用フロー
1. スクリプト実行
2. モード選択（TODO/カレンダー）
3. カレンダーモードの場合は直接月選択画面へ
4. インタラクティブメニューで機能選択・実行
5. 結果表示
6. **重要**: 全選択画面で"q"入力時はメインメニューに戻る

## 技術要件

### 依存関係
- **標準ライブラリ**: csv, date
- **追加gem**: なし（標準ライブラリのみ）

### ファイル操作
- CSVファイルの読み書き
- ドットファイル作成・更新
- 自動バックアップ（終了時保存）

### エラーハンドリング
- ファイル存在確認・自動作成
- 不正入力チェック（空文字、不正ID等）
- データ整合性確認
- 削除時の確認プロンプト

## データベース設計（CSV）

### メインデータ (.todo_data.csv)
```csv
id,project_id,project_name,task_id,task_name,level,priority,repeat_type,created_date,completed_date,parent_id
```

#### フィールド説明
- **id**: 全体通し番号（プロジェクト・タスク共通）
- **project_id**: 所属プロジェクトのID
- **project_name**: プロジェクト名
- **task_id**: プロジェクト内のタスク番号（0=プロジェクト）
- **task_name**: タスク名
- **level**: 階層レベル（0=プロジェクト、1=直下タスク、2=サブタスク...）
- **priority**: high/medium/low
- **repeat_type**: none/daily/weekly/monthly
- **created_date**: 作成日（YYYY-MM-DD）
- **completed_date**: 完了日（YYYY-MM-DD、未完了時は空）
- **parent_id**: 親タスクのID（ルートタスクは空）

### カレンダーデータ (.todo_calendar.csv)  
```csv
date,month,week,weekday,day,completed_task,project_name
```

### 設定データ (.todo_config.csv)
```csv
key,value
sort_order,priority
current_quarter,2024-Q2
```

## 表示要件
- **視覚的表示**: ANSIカラーコードによる色分け
- **階層構造**: インデントによる明確な表現
- **プライオリティ**: 色による視覚化（赤/黄/緑）
- **日本語対応**: 文字幅を考慮した整列表示
- **固定幅レイアウト**: カレンダー表示での列揃え

## パフォーマンス要件
- **高速起動**: 1秒以内
- **大量データ対応**: 1000タスク程度
- **レスポンシブ**: インタラクティブ操作感
- **メモリ効率**: 全データメモリ管理でも軽量

## 実装状況

### ✅ 完全実装済み
- ✅ Ruby言語でのオブジェクト指向設計
- ✅ CSVデータ永続化
- ✅ プロジェクト作成・削除・一覧・リネーム
- ✅ 階層タスク作成・削除・一覧・完了・リネーム
- ✅ プライオリティ管理（色分け表示）
- ✅ 繰り返しタスク設定
- ✅ 週区分別カレンダー表示（全日表示、複数タスク対応）
- ✅ インタラクティブメニューシステム
- ✅ 全画面"q"でメインメニュー復帰
- ✅ 削除時の安全確認機能
- ✅ 関連データの整合性管理

### 🔄 拡張可能機能
- タスク検索機能
- 並び替え機能の詳細実装
- 4半期目標管理
- 繰り返しタスクの詳細設定（週区分、曜日指定）
- エクスポート機能
- バックアップ・復元機能

## セキュリティ・品質
- **データ整合性**: 削除・リネーム時の関連データ自動更新
- **入力検証**: 全入力値の妥当性確認
- **エラー処理**: ユーザーフレンドリーなエラーメッセージ
- **データ保護**: 削除前の確認プロンプト